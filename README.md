# ‚õÖ VPC terraform infra

–¢—É—Ç –æ–ø–∏—Å–∞–Ω–æ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–ª–∞–∫–∞ VPC –∏ –Ω–µ–º–Ω–æ–≥–æ k8s –∫–æ–Ω—Ñ–∏–≥–∞.

## üå≥ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã terraform —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –º–æ–¥—É–ª–∏ –∏ –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç
–∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é —á–∞—Å—Ç—å –æ–±–ª–∞–∫–∞ VPC:

```
.
‚îú‚îÄ‚îÄ main.tf
‚îú‚îÄ‚îÄ modules
‚îÇ   ‚îú‚îÄ‚îÄ dns
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vars.tf
‚îÇ   ‚îú‚îÄ‚îÄ k8s
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ output.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vars.tf
‚îÇ   ‚îú‚îÄ‚îÄ mks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ output.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vars.tf
‚îÇ   ‚îî‚îÄ‚îÄ vpc
‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ       ‚îú‚îÄ‚îÄ output.tf
‚îÇ       ‚îî‚îÄ‚îÄ vars.tf
‚îú‚îÄ‚îÄ providers.tf
‚îî‚îÄ‚îÄ vars.tf
```

–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏–π:

- —Å–æ–∑–¥–∞—ë–º –ø—Ä–æ–µ–∫—Ç –≤ VPC
- —Å–æ–∑–¥–∞—ë–º MKS-–∫–ª–∞—Å—Ç–µ—Ä –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ
- —Å–æ–∑–¥–∞—ë–º –≥—Ä—É–ø–ø—É –Ω–æ–¥ –¥–ª—è MKS-–∫–ª–∞—Å—Ç–µ—Ä–∞
- —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º ingress-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤ MKS-–∫–ª–∞—Å—Ç–µ—Ä–µ
- —Å–æ–∑–¥–∞—ë–º wildcard A-–∑–∞–ø–∏—Å—å –¥–ª—è floating-ip –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
  (–∫–æ—Ç–æ—Ä—ã–π –ø–æ—è–≤–∏–ª—Å—è –≤–º–µ—Å—Ç–µ —Å ingress-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º)

## ‚öì –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∏—Ö —É–º–æ–ª—á–∞–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                          | –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ                                   |
|:----------------------------------- |:------------------ |:-------------------------------------------- |
| `sel_token`                         | `""`               | –¢–æ–∫–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤ VPC       |
| `project_name`                      | `infra`            | –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ VPC                            |
| `user_name`                         | `infra_user`       | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ VPC                       |
| `user_password`                     | `""`               | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ VPC                    |
| `domain_name`                       | `shatoh.in`        | –ò–º—è –¥–æ–º–µ–Ω–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ø–∞–Ω–µ–ª—å           |
| `cluster_name`                      | `cluster-01`       | –ò–º—è –∫–ª–∞—Å—Ç–µ—Ä–∞ MKS                             |
| `region`                            | `ru-3`             | –†–µ–≥–∏–æ–Ω VPC –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤             |
| `kube_version`                      | `1.18.20`          | –í–µ—Ä—Å–∏—è K8S –≤ MKS-–∫–ª–∞—Å—Ç–µ—Ä–µ                    |
| `enable_autorepair`                 | `true`             | –ê–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–¥ MKS-–∫–ª–∞—Å—Ç–µ—Ä–∞          |
| `enable_patch_version_auto_upgrade` | `true`             | –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ç—á-–≤–µ—Ä—Å–∏–π                   |
| `availability_zone`                 | `ru-3a`            | –ó–æ–Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ VPC                  |
| `nodes_count`                       | `2`                | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–¥ MKS-–∫–ª–∞—Å—Ç–µ—Ä–∞                  |
| `cpus`                              | `2`                | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä —É –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã –≤ MKS-–∫–ª–∞—Å—Ç–µ—Ä–µ |
| `ram_mb`                            | `2048`             | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –û–ó–£ —É –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã –≤ MKS-–∫–ª–∞—Å—Ç–µ—Ä–µ  |
| `volume_gb`                         | `16`               | –û–±—ä—ë–º –¥–∏—Å–∫–∞ —É –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã –≤ MKS-–∫–ª–∞—Å—Ç–µ—Ä–µ     |
| `volume_type`                       | `fast.ru-3a`       | –¢–∏–ø –¥–∏—Å–∫–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã –≤ MKS-–∫–ª–∞—Å—Ç–µ—Ä–µ         |

## üöÄ S3 –∫–∞–∫ tf-state

–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è `tf-state` –∏—Å–ø–æ–ª—å–∑—É–µ–º [S3](https://www.terraform.io/docs/language/settings/backends/s3.html).

## üèó CI/CD –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

To DO

## ü§ô Ingress-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

–ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–Ω—ã–π üòç[Contour-ingress](https://projectcontour.io)
–ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –Ω–∞ –º–æ–ª–æ–¥—ë–∂–Ω–æ–º ü§©[Envoy](https://www.envoyproxy.io)
